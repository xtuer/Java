# 开发环境和打包发布

## 开发环境搭建
1. 系统 hosts 里添加 `127.0.0.1 survey.edu-edu.com.cn`，方便和线上环境一样

2. MySQL 中创建数据库，名字为 survey (编码使用 UTF-8)，然后初始化数据库，导入 **database.sql**，里面已经有一个测试数据

3. 安装 **Gradle**

4. Debug 模式运行工程: `gradle clean appStartDebug`

5. 访问 `http://survey.edu-edu.com.cn`
    * 要求登陆: admin/Passw0rd
    * 登陆成功后自动重定向到 `http://survey.edu-edu.com.cn/admin/topics`

    > 注意: 项目默认运行于 8080 端口，为了使用 80 端口访问，
    >
    >    * 可以使用端口映射工具把 8080 端口映射到 80 端口 (Linux 可以使用 Shell 脚本实现)
    >    * 可以修改 build.gradle 中 httpPort = 80 (Linux 和 Mac 需要 Root 用户才能启动 80 端口)
    >    * 可以使用 Nginx 等做负载均衡，把 `http://survey.edu-edu.com.cn` 的访问负债到 `http://127.0.0.1:8080` (推荐使用 Nginx，这样还可以做集群)

## 打包发布

可以使用 gradle deploy 命令，也可以手动发布项目，推荐使用 deploy 命令的方式:

* 使用 gradle deploy 命令
  1. 修改 build.gradle 中的项目部署部分为服务器上的路径等
  2. 运行命令 `gradle -Denv=production clean deploy` 即会自动编译、打包、上传到服务器，然后重启 Tomcat 等一条命令完成发布的所有操作
* 手动发布
  1. 运行命令 `gradle -Denv=production clean build` 得到 `build/libs/ROOT.zip`
  2. 上传到服务器 `eplatform.edu-edu.com.cn` 的目录 `/usr/local/edu/apache-tomcat-6.0.37/webapps` 下
  3. 运行命令 `../bin/catalina.sh stop; rm -rf ROOT; unzip ROOT.zip -d ROOT; rm -rf ROOT.zip; ../bin/catalina.sh start` 部署成功 (为了简单，直接放在 ROOT 目录下了)
  4. 访问 `http://survey.edu-edu.com.cn`