## 用户

用户角色修改 user_role 表

## 订单

增加订单类型:

```sql
alter table `order` add column type int(11) DEFAULT 0  COMMENT '订单类型: 0 (销售订单)、1 (样品订单)';
alter table `order` add column product_names text COMMENT '产品名称，使用逗号分隔';
```

## 审批

创建表 audit_step

```sql
DROP TABLE IF EXISTS audit_step;

CREATE TABLE audit_step (
    type          varchar(64) NOT NULL         COMMENT '审批类型',
    audit_id      bigint(20) unsigned NOT NULL COMMENT '审批 ID',
    step          int(11)    DEFAULT 0         COMMENT '审批的阶段，每个阶段有多个候选审批员，当只会选择一个来审批',
    applicant_id  bigint(20) unsigned NOT NULL COMMENT '审批申请人的 ID',
    target_id     bigint(20) unsigned NOT NULL COMMENT '审批目标的 ID',
    auditor_id    bigint(20) DEFAULT 0         COMMENT '审批员 ID',
    state         int(11)    DEFAULT 0         COMMENT '审批状态: 0 (初始化), 1 (待审批), 2 (拒绝), 3 (通过)',
    comment       text                         COMMENT '审批意见',
    attachment_id bigint(20) DEFAULT 0         COMMENT '附件 ID',

    processed_at datetime COMMENT '处理时间',
    created_at   datetime  NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at   timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',

    id int(11) PRIMARY KEY AUTO_INCREMENT COMMENT '自增 ID',
    UNIQUE KEY idx_audit_step (audit_id, step) COMMENT '审批中的 step 不能重复',
    KEY index_auditor (auditor_id, state) COMMENT '按审批员进行索引',
    KEY index_target (target_id) COMMENT '按审批目标进行索引'
) ENGINE=InnoDB COMMENT '审批阶段';
```

## 库存

创建表 stock

```sql
CREATE TABLE stock (
    product_item_id bigint(20)  unsigned NOT NULL COMMENT '物料 ID',
    batch           varchar(64) NOT NULL          COMMENT '批次',
    count           int(11)     DEFAULT 0         COMMENT '数量',

    created_at datetime  NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',

    PRIMARY KEY (product_item_id, batch) COMMENT '物料 ID + 批次作为主键'
)ENGINE=InnoDB COMMENT '物料库存';
```

