<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--file_directory_id | display_name | file_unique_name | is_file | parent_directory_id | user_id | mark_as_deleted-->
<mapper namespace="com.eduedu.ebag.mapper.filesystem.FileDirectoryMapper">
    <sql id="file_directory_columns">
        file_directory_id   as fileDirectoryId,
        display_name        as displayName,
        file_unique_name    as fileUniqueName,
        is_file             as isFile,
        parent_directory_id as parentDirectoryId,
        user_id             as userId,
        external            as external,
        mark_as_deleted     as markAsDeleted
    </sql>

    <select id="listFilesByDirectoryId" resultType="FileDirectory">
        SELECT <include refid="file_directory_columns"/>
        FROM file_directory
        WHERE parent_directory_id=#{directoryId} AND is_file=1 AND user_id=#{userId}
    </select>

    <select id="listSubdirectoriesByDirectoryId" resultType="FileDirectory">
        SELECT <include refid="file_directory_columns"/>
        FROM file_directory
        WHERE parent_directory_id=#{directoryId} AND is_file!=1 AND user_id=#{userId}
    </select>

    <select id="listFilesAndSubdirectoriesByDirectoryId" resultType="FileDirectory">
        SELECT <include refid="file_directory_columns"/>
        FROM file_directory
        WHERE parent_directory_id=#{directoryId} AND user_id=#{userId}
    </select>

    <insert id="insertFileDirectory" parameterType="FileDirectory">
        INSERT INTO file_directory (display_name, file_unique_name, is_file, parent_directory_id, user_id, external, mark_as_deleted)
        VALUES (#{displayName}, #{fileUniqueName}, #{isFile}, #{parentDirectoryId}, #{userId}, #{external}, #{markAsDeleted})
    </insert>

    <update id="markAsDeleted" parameterType="int">
        UPDATE file_directory
        SET mark_as_deleted=1
        WHERE file_directory_id=#{fileDirectoryId} AND user_id=#{userId}
    </update>
</mapper>
