考试主要设计以下 4 个 URL:

* 某次考试: /api/exam/users/{userId}/exams/{examId}
* 考试记录: /api/exam/users/{userId}/exams/{examId}/records
* 考试记录: /api/exam/users/{userId}/exams/{examId}/records/{recordId}
* 题目作答: /api/exam/users/{userId}/exams/{examId}/records/{recordId}/answer

## 开始考试

1. 前端: 点击`开始考试`按钮，发送 POST 请求 `/api/exam/users/{userId}/exams/{examId}/records`
2. 后端: 查询已经存在的考试记录数量
    1. 如果大于等于最多考试次数，则返回不允许创建新的考试
    2. 如果小于最多考试次数，创建考试记录，返回考试记录 ID
3. 前端: 发送 GET 请求 `/api/exam/users/{userId}/exams/{examId}/records/{recordId}` 获取考试信息
4. 后端: 返回考试记录 (包括试卷信息，作答信息)
5. 前端: 显示考试界面

## 继续考试

1. 前端: 点击继续考试按钮，发送 GET 请求 `/api/exam/users/{userId}/exams/{examId}/records/{recordId}`
2. 后端: 判断是否在考试时间内，并没有使用完允许的考试时间
   1. 是: 返回考试记录 (包括试卷信息，题目作答信息)
   2. 否: 不允许考试
3. 前端: 显示考试界面

## 考试作答

作答保存到 MongoDB (**复合题的小题作答展开保存**):

1. 前端: 点击客观题答案，回复主观题，发送 POST 请求: `/api/exam/users/{userId}/exams/{examId}/records/{recordId}/answer` (当前题目的所有选项的作答)
2. 后端: 删除此题目的所有作答，保存新的作答

## 提交试卷

交卷逻辑:

1. 前端: 点击提交按钮，一次性把整个试卷的所有题目的作答发送给服务器
2. 后端: 删除题目的所有作答，保存新的作答
3. 后端: 对客观题进行批改
    * 如果全是客观题的试卷，标记考试批改完成
    
    * 如有有主观题，标记为已自动批改，后续需要老师手动批改
    * 提取主观题的作答 (**复合题的作答合并保存，方便主题批改**)

注意: 对于进行了作答，但是未提交的试卷，在获取考试记录时不能继续作答的情况下合并作答到考试记录，然后自动批改客观题。

## 作答内容

为了使用同一个接口提交单个题目的作答和交卷，都使用同一个接口 `/api/exam/exams/{examId}/records/{recordId}/answer`，带上 submitted 的标志即可，参数为数组:

```json
{
    "submitted": true,
    "questions": [
         { "questionId": 0, answers: [{ "questionOptionId": 0, "content": "xxx" }, { "questionOptionId": 0, "content": "xxx" }] },
         { "questionId": 0, answers: [{ "questionOptionId": 0, "content": "xxx" }, { "questionOptionId": 0, "content": "xxx" }] },
         { "questionId": 0, answers: [{ "questionOptionId": 0, "content": "xxx" }, { "questionOptionId": 0, "content": "xxx" }] },
    ]
}
```

## 批改完成

触发试卷批改有以下 3 种情况:

* 客观题试卷: 交卷时自动批改，考试记录的 status 为 4
* 整卷批改: 老师批改部分，然后点击批改完成按钮，考试记录的 status 为 4 (可以触发逐题批改来完成)
* 逐题批改: 老师单个题批改，每次批改后都会检查是否所有题目的 scoreStatus 都为非 0，如果是则修改考试记录的 status 为 4

